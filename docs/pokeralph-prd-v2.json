{
  "project": {
    "name": "PokéRalph",
    "description": "Um orquestrador de loops Ralph com interface temática de Pokémon Game Boy. Transforma o desenvolvimento autônomo com Claude Code em uma experiência gamificada onde cada task é uma batalha.",
    "version": "0.1.0",
    "repository": "pokeralph"
  },
  "stack": {
    "runtime": "Bun",
    "monorepo": "Bun workspaces",
    "language": "TypeScript (strict mode)",
    "packages": {
      "@pokeralph/core": "Lógica de negócio pura, zero dependências de UI",
      "@pokeralph/server": "API REST + WebSocket com Hono",
      "@pokeralph/web": "React + Vite SPA",
      "@pokeralph/desktop": "Tauri v2 (futuro)",
      "@pokeralph/cli": "Ink ou OpenTUI (futuro)"
    },
    "tooling": {
      "bundler": "Vite (web), Bun (server/core)",
      "linting": "ESLint + Biome",
      "formatting": "Biome",
      "testing": "Bun test (core/server), Vitest (web)",
      "typecheck": "TypeScript tsc"
    }
  },
  "architecture": {
    "overview": "Monorepo com separação clara entre lógica de negócio (core), servidor (server) e interfaces (web/desktop/cli). Core é 100% portátil e todas as interfaces consomem o server via HTTP/WebSocket.",
    "diagram": [
      "┌─────────────────────────────────────────────────────────┐",
      "│                    INTERFACES (UI)                       │",
      "├─────────────┬─────────────┬──────────────┬──────────────┤",
      "│   Web App   │   Desktop   │    Mobile    │     CLI      │",
      "│ React+Vite  │   Tauri v2  │ React Native │  Ink/OpenTUI │",
      "│   (v0.1)    │   (v0.3)    │   (futuro)   │    (v0.2)    │",
      "└──────┬──────┴──────┬──────┴──────┬───────┴──────┬───────┘",
      "       └─────────────┴──────┬──────┴──────────────┘",
      "                           │ HTTP / WebSocket",
      "┌──────────────────────────▼──────────────────────────────┐",
      "│                  @pokeralph/server                       │",
      "│              API REST + WebSocket (Hono)                 │",
      "│           Roda local, todas as UIs conectam              │",
      "└──────────────────────────┬──────────────────────────────┘",
      "                           │ imports",
      "┌──────────────────────────▼──────────────────────────────┐",
      "│                  @pokeralph/core                         │",
      "│            Lógica de negócio (100% portátil)             │",
      "│     Types, Claude bridge, Loop controller, Services      │",
      "└─────────────────────────────────────────────────────────┘"
    ],
    "monorepo_structure": {
      "root": {
        "package.json": "Workspace root com scripts globais",
        "bunfig.toml": "Configuração do Bun",
        "tsconfig.json": "Config base do TypeScript",
        "biome.json": "Linting e formatting",
        ".gitignore": "Ignora node_modules, dist, .pokeralph/battles/"
      },
      "packages/core/": {
        "package.json": "name: @pokeralph/core",
        "src/types/": "Interfaces e tipos compartilhados",
        "src/services/": "FileManager, ClaudeBridge, LoopController, etc",
        "src/utils/": "Helpers puros",
        "src/index.ts": "Export público",
        "tests/": "Testes unitários com Bun test"
      },
      "packages/server/": {
        "package.json": "name: @pokeralph/server, depends on @pokeralph/core",
        "src/routes/": "Endpoints da API",
        "src/websocket/": "Handler de WebSocket",
        "src/middleware/": "Middlewares Hono",
        "src/index.ts": "Entry point do servidor",
        "tests/": "Testes de integração"
      },
      "packages/web/": {
        "package.json": "name: @pokeralph/web",
        "src/components/": "Componentes React",
        "src/hooks/": "Custom hooks",
        "src/views/": "Views principais (Planning, Battle, Dashboard)",
        "src/stores/": "State management (Zustand)",
        "src/api/": "Client HTTP + WebSocket",
        "src/App.tsx": "Root component",
        "index.html": "Entry HTML",
        "vite.config.ts": "Config Vite"
      }
    },
    "persistence": {
      "location": ".pokeralph/ na raiz do repo do usuário",
      "files": {
        ".pokeralph/config.json": "Configurações do projeto",
        ".pokeralph/prd.json": "PRD com todas as tasks e status",
        ".pokeralph/battles/": "Pasta com histórico de batalhas",
        ".pokeralph/battles/{task-id}/progress.json": "Progresso atual (polling)",
        ".pokeralph/battles/{task-id}/history.json": "Array de iterações completadas",
        ".pokeralph/battles/{task-id}/logs/": "Logs detalhados por iteração"
      }
    }
  },
  "modes": {
    "hitl": {
      "name": "Human in the Loop",
      "description": "Após cada iteração, aguarda aprovação do usuário para continuar",
      "use_case": "Tasks de alto risco, arquitetura, primeiras execuções"
    },
    "yolo": {
      "name": "YOLO Mode", 
      "description": "Executa automaticamente até completar ou atingir max iterations",
      "use_case": "Tasks de baixo risco, testes, refatorações simples"
    }
  },
  "tasks": [
    {
      "id": "001-monorepo-setup",
      "category": "infrastructure",
      "priority": 1,
      "title": "Setup do monorepo com Bun workspaces",
      "description": "Criar estrutura base do monorepo com todos os packages configurados",
      "acceptance_criteria": [
        "Inicializar repo com 'bun init'",
        "Configurar workspaces em package.json: packages/*",
        "Criar packages/core com package.json (@pokeralph/core)",
        "Criar packages/server com package.json (@pokeralph/server)",
        "Criar packages/web com package.json (@pokeralph/web)",
        "tsconfig.json base na raiz com strict mode",
        "Cada package extende tsconfig base",
        "biome.json configurado para lint + format",
        "Scripts na raiz: dev, build, test, lint, typecheck",
        "'bun run dev' roda server + web simultaneamente",
        "'bun run test' roda testes de todos os packages",
        "Verificar que imports entre packages funcionam"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 3
    },
    {
      "id": "002-core-types",
      "category": "architecture",
      "priority": 2,
      "title": "Definir tipos core em @pokeralph/core",
      "description": "Criar todas as interfaces TypeScript para o domínio da aplicação",
      "acceptance_criteria": [
        "src/types/prd.ts: Interface PRD { name, description, tasks[], metadata }",
        "src/types/task.ts: Interface Task { id, title, description, status, priority, acceptanceCriteria[], iterations[], createdAt, updatedAt }",
        "src/types/task.ts: Enum TaskStatus { pending, planning, in_progress, paused, completed, failed }",
        "src/types/config.ts: Interface Config { maxIterationsPerTask, mode, feedbackLoops[], timeoutMinutes, pollingIntervalMs, autoCommit }",
        "src/types/progress.ts: Interface Progress { taskId, currentIteration, status, lastUpdate, logs[] }",
        "src/types/iteration.ts: Interface Iteration { number, startedAt, endedAt?, output, result, filesChanged[] }",
        "src/types/battle.ts: Interface Battle { taskId, status, iterations[], startedAt, completedAt? }",
        "src/types/events.ts: Types para eventos do sistema (iteration_start, iteration_end, etc)",
        "src/types/index.ts: Re-exporta todos os tipos",
        "Todos os tipos com JSDoc documentando cada campo",
        "Testes de tipo (type assertions) para validar schemas"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 2
    },
    {
      "id": "003-core-file-manager",
      "category": "core",
      "priority": 3,
      "title": "Serviço FileManager em @pokeralph/core",
      "description": "Serviço responsável por toda I/O de arquivos na pasta .pokeralph",
      "acceptance_criteria": [
        "src/services/file-manager.ts: Classe FileManager",
        "constructor(basePath: string) define raiz do repo",
        "getPokeRalphPath() retorna caminho da pasta .pokeralph",
        "init() cria estrutura de pastas se não existir",
        "exists() verifica se .pokeralph existe",
        "loadConfig(): Config lê e valida config.json",
        "saveConfig(config: Config) escreve config.json",
        "loadPRD(): PRD lê e valida prd.json",
        "savePRD(prd: PRD) escreve prd.json",
        "createBattleFolder(taskId: string) cria pasta da batalha",
        "loadProgress(taskId: string): Progress lê progress.json",
        "saveProgress(taskId: string, progress: Progress) escreve progress.json",
        "loadBattleHistory(taskId: string): Battle lê history.json",
        "appendIteration(taskId: string, iteration: Iteration) adiciona ao history",
        "writeIterationLog(taskId: string, iterationNum: number, log: string) salva log",
        "Validação com Zod schemas para todas as leituras",
        "Tratamento de erros consistente (FileNotFoundError, ValidationError)",
        "Testes unitários com pasta temporária para cada teste"
      ],
      "passes": false,
      "risk": "medium",
      "estimated_iterations": 4
    },
    {
      "id": "004-core-prompt-builder",
      "category": "core",
      "priority": 4,
      "title": "Serviço PromptBuilder em @pokeralph/core",
      "description": "Constrói prompts otimizados para o Claude Code em diferentes contextos",
      "acceptance_criteria": [
        "src/services/prompt-builder.ts: Classe PromptBuilder",
        "buildPlanningPrompt(idea: string): string para iniciar plan mode",
        "buildTaskPrompt(task: Task, context: TaskContext): string para executar task",
        "TaskContext inclui: PRD resumido, progresso atual, arquivos relevantes",
        "Prompt de task inclui instrução para atualizar progress.json",
        "Prompt de task inclui formato esperado do output",
        "Prompt inclui completion sigil: <promise>COMPLETE</promise>",
        "Prompt inclui instrução de feedback loops a rodar",
        "Prompt inclui instrução de commit após sucesso",
        "buildBreakdownPrompt(prd: string): string para quebrar PRD em tasks",
        "Templates são constantes bem documentadas",
        "Testes verificando estrutura dos prompts gerados"
      ],
      "passes": false,
      "risk": "medium",
      "estimated_iterations": 3
    },
    {
      "id": "005-core-claude-bridge",
      "category": "core",
      "priority": 5,
      "title": "Serviço ClaudeBridge em @pokeralph/core",
      "description": "Bridge que spawna Claude Code CLI e monitora execução via polling de arquivos",
      "acceptance_criteria": [
        "src/services/claude-bridge.ts: Classe ClaudeBridge",
        "constructor(options: ClaudeBridgeOptions) com workingDir, timeout, etc",
        "spawnPlanMode(prompt: string): ChildProcess inicia claude em plan mode",
        "spawnExecutionMode(prompt: string): ChildProcess inicia com acceptEdits",
        "buildCommand(mode: 'plan' | 'execute', prompt: string): string[]",
        "Usa Bun.spawn() para criar child process",
        "kill() mata processo atual",
        "isRunning(): boolean verifica se processo está ativo",
        "onExit(callback) handler para quando processo termina",
        "Captura stdout/stderr para logs",
        "Timeout configurável que mata processo",
        "Testes com mock do Claude Code (script fake que simula comportamento)"
      ],
      "passes": false,
      "risk": "high",
      "estimated_iterations": 5
    },
    {
      "id": "006-core-progress-watcher",
      "category": "core",
      "priority": 6,
      "title": "Serviço ProgressWatcher em @pokeralph/core",
      "description": "Monitora arquivos de progresso via polling e emite eventos",
      "acceptance_criteria": [
        "src/services/progress-watcher.ts: Classe ProgressWatcher extends EventEmitter",
        "constructor(fileManager: FileManager, intervalMs: number)",
        "watch(taskId: string) inicia polling do progress.json da task",
        "stop() para o polling",
        "Emite evento 'progress' quando arquivo muda",
        "Emite evento 'complete' quando detecta completion sigil",
        "Emite evento 'error' quando detecta erro no progress",
        "Debounce para não emitir eventos duplicados",
        "Compara hash do arquivo para detectar mudanças reais",
        "Testes com arquivos que mudam durante execução"
      ],
      "passes": false,
      "risk": "medium",
      "estimated_iterations": 3
    },
    {
      "id": "007-core-feedback-runner",
      "category": "core",
      "priority": 7,
      "title": "Serviço FeedbackRunner em @pokeralph/core",
      "description": "Executa feedback loops (test, lint, typecheck) e reporta resultados",
      "acceptance_criteria": [
        "src/services/feedback-runner.ts: Classe FeedbackRunner",
        "constructor(workingDir: string)",
        "detectAvailableLoops(): string[] descobre scripts no package.json",
        "runLoop(name: string): FeedbackResult executa um loop específico",
        "runAll(loops: string[]): FeedbackResult[] executa múltiplos loops",
        "FeedbackResult: { name, passed, output, duration }",
        "Suporta: test, lint, typecheck, format:check",
        "Timeout por loop (configurável)",
        "Captura stdout/stderr completo",
        "Detecta exit code para pass/fail",
        "Testes com package.json fake"
      ],
      "passes": false,
      "risk": "medium",
      "estimated_iterations": 3
    },
    {
      "id": "008-core-git-service",
      "category": "core",
      "priority": 8,
      "title": "Serviço GitService em @pokeralph/core",
      "description": "Gerencia operações Git (commit, status, revert)",
      "acceptance_criteria": [
        "src/services/git-service.ts: Classe GitService",
        "constructor(workingDir: string)",
        "isRepo(): boolean verifica se é um repo git",
        "init(): void inicializa repo se não existir",
        "status(): GitStatus retorna arquivos modificados",
        "add(files: string[] | 'all') adiciona arquivos ao stage",
        "commit(message: string): string retorna hash do commit",
        "getLastCommit(): CommitInfo retorna info do último commit",
        "revert(): void desfaz último commit (soft reset)",
        "Mensagem de commit formatada: '[PokéRalph] {taskId}: {title}'",
        "Ignora .pokeralph/battles/ automaticamente",
        "Usa Bun.spawn() com comandos git",
        "Testes com repo temporário"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 3
    },
    {
      "id": "009-core-loop-controller",
      "category": "core",
      "priority": 9,
      "title": "Serviço LoopController em @pokeralph/core",
      "description": "Orquestra o loop Ralph completo para uma task",
      "acceptance_criteria": [
        "src/services/loop-controller.ts: Classe LoopController extends EventEmitter",
        "constructor(dependencies: { fileManager, claudeBridge, progressWatcher, feedbackRunner, gitService, promptBuilder })",
        "startBattle(taskId: string, mode: 'hitl' | 'yolo'): void inicia execução",
        "Implementa loop: prompt → execute → poll → feedback → commit → repeat",
        "Respeita maxIterations da config",
        "Detecta completion sigil e para loop",
        "Detecta falhas e marca task como failed",
        "pause(): void pausa após iteração atual",
        "resume(): void retoma execução pausada",
        "cancel(): void cancela e marca como failed",
        "Em modo HITL: emite 'await_approval' e espera approve()",
        "approve(): void continua após HITL pause",
        "Emite eventos: battle_start, iteration_start, iteration_end, feedback_result, battle_complete, battle_failed, await_approval",
        "Persiste estado entre iterações via FileManager",
        "Recupera estado se reiniciado no meio",
        "Testes E2E com mock do Claude"
      ],
      "passes": false,
      "risk": "high",
      "estimated_iterations": 6
    },
    {
      "id": "010-core-plan-service",
      "category": "core",
      "priority": 10,
      "title": "Serviço PlanService em @pokeralph/core",
      "description": "Gerencia fase de planejamento e geração de PRD",
      "acceptance_criteria": [
        "src/services/plan-service.ts: Classe PlanService extends EventEmitter",
        "constructor(dependencies: { claudeBridge, promptBuilder, fileManager })",
        "startPlanning(idea: string): void inicia plan mode",
        "Estado interno: planning, waiting_input, completed",
        "Emite 'output' com streaming do Claude",
        "Emite 'question' quando Claude faz pergunta",
        "answerQuestion(answer: string): void envia resposta",
        "finishPlanning(): PRD finaliza e extrai PRD",
        "breakIntoTasks(prd: PRD): Task[] quebra PRD em tasks",
        "Pode usar nova instância do Claude para breakdown",
        "savePRD(prd: PRD): void persiste via FileManager",
        "Testes com mock de conversas"
      ],
      "passes": false,
      "risk": "high",
      "estimated_iterations": 5
    },
    {
      "id": "011-core-orchestrator",
      "category": "core",
      "priority": 11,
      "title": "Classe Orchestrator principal em @pokeralph/core",
      "description": "Fachada que unifica todos os serviços e expõe API limpa",
      "acceptance_criteria": [
        "src/orchestrator.ts: Classe Orchestrator",
        "constructor(workingDir: string) inicializa todos os serviços",
        "init(): void inicializa .pokeralph se necessário",
        "getConfig(): Config retorna config atual",
        "updateConfig(partial: Partial<Config>): void atualiza config",
        "getPRD(): PRD | null retorna PRD atual",
        "startPlanning(idea: string): void delega para PlanService",
        "onPlanningOutput(callback): void",
        "onPlanningQuestion(callback): void", 
        "answerPlanningQuestion(answer: string): void",
        "finishPlanning(): PRD",
        "getTasks(): Task[] retorna todas as tasks",
        "getTask(id: string): Task | null",
        "addTask(task: Omit<Task, 'id'>): Task adiciona task ao PRD",
        "updateTask(id: string, partial: Partial<Task>): Task",
        "startBattle(taskId: string): void delega para LoopController",
        "pauseBattle(): void",
        "resumeBattle(): void",
        "cancelBattle(): void",
        "approveBattle(): void para HITL",
        "onBattleEvent(event: string, callback): void",
        "getBattleProgress(taskId: string): Progress | null",
        "getBattleHistory(taskId: string): Battle | null",
        "Singleton ou factory pattern",
        "src/index.ts exporta Orchestrator e todos os tipos",
        "Testes de integração do fluxo completo"
      ],
      "passes": false,
      "risk": "medium",
      "estimated_iterations": 4
    },
    {
      "id": "012-server-setup",
      "category": "server",
      "priority": 12,
      "title": "Setup do servidor Hono em @pokeralph/server",
      "description": "Configurar servidor HTTP com Hono e estrutura de rotas",
      "acceptance_criteria": [
        "src/index.ts: Entry point que inicia servidor",
        "Usa Hono com adapter para Bun",
        "CORS configurado para localhost",
        "Middleware de logging",
        "Middleware de error handling",
        "src/routes/index.ts: Agrupa todas as rotas",
        "Porta configurável via env PORT (default 3456)",
        "Health check em GET /health",
        "Graceful shutdown",
        "Instancia Orchestrator do @pokeralph/core",
        "Testa com bun run (server) e curl"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 2
    },
    {
      "id": "013-server-config-routes",
      "category": "server",
      "priority": 13,
      "title": "Rotas de configuração em @pokeralph/server",
      "description": "Endpoints para ler e atualizar configuração",
      "acceptance_criteria": [
        "src/routes/config.ts: Router de config",
        "GET /api/config retorna config atual",
        "PUT /api/config atualiza config (validação com Zod)",
        "Retorna 400 se validação falhar",
        "Testes de integração"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 2
    },
    {
      "id": "014-server-prd-routes",
      "category": "server",
      "priority": 14,
      "title": "Rotas de PRD/Tasks em @pokeralph/server",
      "description": "Endpoints para gerenciar PRD e tasks",
      "acceptance_criteria": [
        "src/routes/prd.ts: Router de PRD",
        "GET /api/prd retorna PRD completo",
        "PUT /api/prd atualiza PRD inteiro",
        "GET /api/tasks retorna array de tasks",
        "GET /api/tasks/:id retorna task específica",
        "POST /api/tasks cria nova task",
        "PUT /api/tasks/:id atualiza task",
        "DELETE /api/tasks/:id remove task",
        "Validação com Zod em todos os endpoints",
        "Testes de integração"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 3
    },
    {
      "id": "015-server-planning-routes",
      "category": "server",
      "priority": 15,
      "title": "Rotas de Planning em @pokeralph/server",
      "description": "Endpoints para fase de planejamento",
      "acceptance_criteria": [
        "src/routes/planning.ts: Router de planning",
        "POST /api/planning/start { idea } inicia plan mode",
        "POST /api/planning/answer { answer } responde pergunta",
        "POST /api/planning/finish finaliza e retorna PRD",
        "GET /api/planning/status retorna estado atual",
        "Retorna 409 se planning já em andamento",
        "Testes de integração"
      ],
      "passes": false,
      "risk": "medium",
      "estimated_iterations": 3
    },
    {
      "id": "016-server-battle-routes",
      "category": "server",
      "priority": 16,
      "title": "Rotas de Battle em @pokeralph/server",
      "description": "Endpoints para controlar execução de tasks",
      "acceptance_criteria": [
        "src/routes/battle.ts: Router de battle",
        "POST /api/battle/start/:taskId inicia batalha",
        "POST /api/battle/pause pausa batalha atual",
        "POST /api/battle/resume retoma batalha",
        "POST /api/battle/cancel cancela batalha",
        "POST /api/battle/approve aprova iteração (HITL)",
        "GET /api/battle/current retorna batalha em andamento",
        "GET /api/battle/:taskId/progress retorna progresso",
        "GET /api/battle/:taskId/history retorna histórico",
        "Retorna 409 se batalha já em andamento",
        "Retorna 404 se task não existe",
        "Testes de integração"
      ],
      "passes": false,
      "risk": "medium",
      "estimated_iterations": 3
    },
    {
      "id": "017-server-websocket",
      "category": "server",
      "priority": 17,
      "title": "WebSocket para eventos real-time",
      "description": "WebSocket que emite eventos do Orchestrator para clientes",
      "acceptance_criteria": [
        "src/websocket/index.ts: Setup WebSocket com Hono",
        "Endpoint /ws aceita conexões",
        "Escuta eventos do Orchestrator e reemite para clientes",
        "Eventos: planning_output, planning_question, battle_start, iteration_start, iteration_end, progress_update, feedback_result, battle_complete, battle_failed, await_approval",
        "Formato: { type: string, payload: any, timestamp: string }",
        "Broadcast para todos os clientes conectados",
        "Heartbeat/ping para detectar conexões mortas",
        "Testes com cliente WebSocket fake"
      ],
      "passes": false,
      "risk": "medium",
      "estimated_iterations": 3
    },
    {
      "id": "018-web-setup",
      "category": "frontend",
      "priority": 18,
      "title": "Setup do React app em @pokeralph/web",
      "description": "Configurar projeto React + Vite + TypeScript",
      "acceptance_criteria": [
        "Inicializar com Vite template react-ts",
        "Configurar path aliases (@/)",
        "Instalar dependências: zustand, react-router-dom",
        "Remover boilerplate default",
        "src/main.tsx: Entry point",
        "src/App.tsx: Router setup",
        "src/index.css: Reset CSS básico",
        "Proxy para API em vite.config.ts (/api → localhost:3456)",
        "'bun run dev' roda na porta 5173",
        "Build funciona sem erros"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 2
    },
    {
      "id": "019-web-api-client",
      "category": "frontend",
      "priority": 19,
      "title": "Cliente API e WebSocket em @pokeralph/web",
      "description": "Módulos para comunicação com o servidor",
      "acceptance_criteria": [
        "src/api/client.ts: Wrapper fetch para endpoints REST",
        "Funções tipadas: getConfig, updateConfig, getPRD, getTasks, etc",
        "Tratamento de erros consistente",
        "src/api/websocket.ts: Cliente WebSocket",
        "connect(): void estabelece conexão",
        "disconnect(): void fecha conexão",
        "on(event, callback): void registra listener",
        "off(event, callback): void remove listener",
        "Reconexão automática se conexão cair",
        "Testes unitários com mocks"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 2
    },
    {
      "id": "020-web-store",
      "category": "frontend",
      "priority": 20,
      "title": "State management com Zustand em @pokeralph/web",
      "description": "Store global para estado da aplicação",
      "acceptance_criteria": [
        "src/stores/app-store.ts: Store principal",
        "Estado: config, prd, tasks, currentBattle, planningState",
        "Actions: setConfig, setPRD, updateTask, setBattleProgress, etc",
        "Selectors: useConfig, useTasks, useCurrentBattle, etc",
        "Integração com WebSocket para updates automáticos",
        "Persist parcial em localStorage (config apenas)",
        "Testes do store"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 2
    },
    {
      "id": "021-web-layout",
      "category": "frontend",
      "priority": 21,
      "title": "Layout base e componentes de UI",
      "description": "Estrutura visual wireframe do app",
      "acceptance_criteria": [
        "src/components/Layout.tsx: Layout principal com sidebar + main",
        "src/components/Sidebar.tsx: Lista de tasks com status",
        "src/components/Header.tsx: Nome do projeto, modo, config button",
        "src/components/TaskCard.tsx: Card de task na sidebar",
        "Indicadores visuais de status: pending (cinza), in_progress (amarelo), completed (verde), failed (vermelho)",
        "Estilo wireframe: bordas simples, cores neutras, sem Pokémon theme ainda",
        "Responsivo: sidebar colapsa em mobile",
        "CSS modules ou Tailwind"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 3
    },
    {
      "id": "022-web-dashboard-view",
      "category": "frontend",
      "priority": 22,
      "title": "View Dashboard/Home",
      "description": "Tela inicial com overview do projeto",
      "acceptance_criteria": [
        "src/views/Dashboard.tsx: View principal",
        "Mostra: total tasks, completadas, pendentes, em progresso",
        "Lista de tasks com filtros (All, Pending, Completed, Failed)",
        "Click em task abre detalhes",
        "Botão 'Start Next Battle' inicia próxima task pendente",
        "Botão 'New Idea' vai para Planning",
        "Estado vazio se não tem PRD: mostra call-to-action para Planning"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 3
    },
    {
      "id": "023-web-planning-view",
      "category": "frontend",
      "priority": 23,
      "title": "View Planning Mode",
      "description": "Interface para fase de planejamento com Claude",
      "acceptance_criteria": [
        "src/views/Planning.tsx: View de planning",
        "Textarea para descrever ideia",
        "Botão 'Start Planning' chama API",
        "Área de chat mostrando output do Claude (streaming via WebSocket)",
        "Quando Claude faz pergunta: mostra input para responder",
        "Botão 'Send Answer' envia resposta",
        "Loading indicators durante processamento",
        "Preview do PRD sendo gerado",
        "Botão 'Finish Planning' finaliza",
        "Tela de review/edit do PRD antes de confirmar",
        "Botão 'Confirm & Start' salva PRD e vai para Dashboard"
      ],
      "passes": false,
      "risk": "medium",
      "estimated_iterations": 4
    },
    {
      "id": "024-web-battle-view",
      "category": "frontend",
      "priority": 24,
      "title": "View Battle (execução de task)",
      "description": "Interface durante execução de uma task",
      "acceptance_criteria": [
        "src/views/Battle.tsx: View de batalha",
        "Mostra task atual: título, descrição, acceptance criteria",
        "Barra de progresso: iteração X de Y",
        "Timer mostrando duração da iteração atual",
        "Área de logs mostrando output do Claude (streaming)",
        "Status dos feedback loops: ✓ test, ✓ lint, ✗ typecheck",
        "Botões de controle: Pause, Cancel",
        "Em modo HITL: botão 'Approve & Continue' aparece após cada iteração",
        "Animação de loading durante execução",
        "Mensagem de sucesso com confetti ao completar",
        "Mensagem de erro se falhar, com botão retry"
      ],
      "passes": false,
      "risk": "medium",
      "estimated_iterations": 4
    },
    {
      "id": "025-web-history-view",
      "category": "frontend",
      "priority": 25,
      "title": "View History de task",
      "description": "Visualização do histórico de uma batalha",
      "acceptance_criteria": [
        "src/views/History.tsx: View de histórico",
        "Recebe taskId como parâmetro de rota",
        "Timeline vertical de iterações",
        "Cada iteração mostra: número, duração, resultado (pass/fail)",
        "Expandir iteração mostra output completo",
        "Lista de arquivos modificados na iteração",
        "Link para commit se disponível",
        "Botão 'Retry Task' se task falhou"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 3
    },
    {
      "id": "026-web-config-modal",
      "category": "frontend",
      "priority": 26,
      "title": "Modal de configuração",
      "description": "Interface para ajustar configurações",
      "acceptance_criteria": [
        "src/components/ConfigModal.tsx: Modal de config",
        "Slider: maxIterationsPerTask (1-50)",
        "Toggle: modo HITL / YOLO",
        "Checkboxes: feedback loops (test, lint, typecheck, format)",
        "Input number: timeoutMinutes",
        "Input number: pollingIntervalMs",
        "Toggle: autoCommit",
        "Botão Save chama API e fecha modal",
        "Botão Cancel fecha sem salvar",
        "Validação inline dos inputs"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 2
    },
    {
      "id": "027-integration-dev-script",
      "category": "infrastructure",
      "priority": 27,
      "title": "Script dev que roda tudo junto",
      "description": "Comando único para desenvolvimento local",
      "acceptance_criteria": [
        "Script 'bun run dev' na raiz do monorepo",
        "Roda server em background na porta 3456",
        "Roda web com Vite na porta 5173",
        "Ambos em watch mode (hot reload)",
        "Ctrl+C mata ambos os processos",
        "Output colorido identificando cada processo",
        "Usa concurrently ou script Bun customizado"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 2
    },
    {
      "id": "028-e2e-tests",
      "category": "testing",
      "priority": 28,
      "title": "Testes E2E do fluxo completo",
      "description": "Testes que validam integração de todos os componentes",
      "acceptance_criteria": [
        "Pasta tests/e2e/ na raiz",
        "Teste: criar PRD via API, verificar persistência",
        "Teste: iniciar batalha, simular progresso, verificar eventos WebSocket",
        "Teste: fluxo HITL com approve manual",
        "Teste: fluxo YOLO até completion",
        "Teste: task que falha marca status corretamente",
        "Mock do Claude Code CLI para testes determinísticos",
        "Script 'bun run test:e2e' roda testes",
        "CI pipeline executando testes em PR"
      ],
      "passes": false,
      "risk": "medium",
      "estimated_iterations": 4
    },
    {
      "id": "029-documentation",
      "category": "docs",
      "priority": 29,
      "title": "Documentação do projeto",
      "description": "README e docs para usuários e contribuidores",
      "acceptance_criteria": [
        "README.md: Overview, features, screenshots",
        "README.md: Quick start (instalação, primeiro uso)",
        "README.md: Comandos disponíveis",
        "README.md: Configuração explicada",
        "README.md: Arquitetura (diagrama)",
        "CONTRIBUTING.md: Como contribuir",
        "CONTRIBUTING.md: Setup de desenvolvimento",
        "CONTRIBUTING.md: Convenções de código",
        "LICENSE: MIT",
        "docs/ARCHITECTURE.md: Detalhes técnicos"
      ],
      "passes": false,
      "risk": "low",
      "estimated_iterations": 2
    }
  ],
  "future_versions": {
    "v0.2.0": {
      "name": "CLI Interface",
      "features": [
        "Comando 'pokeralph init' inicializa projeto",
        "Comando 'pokeralph plan' inicia planning no terminal",
        "Comando 'pokeralph battle' executa task",
        "Comando 'pokeralph status' mostra overview",
        "Interface TUI com Ink ou OpenTUI",
        "Mesma lógica do core, rendering diferente"
      ]
    },
    "v0.3.0": {
      "name": "Desktop App (Tauri)",
      "features": [
        "App nativo para Mac/Windows/Linux",
        "Tauri v2 com frontend React",
        "Notificações nativas do sistema",
        "Ícone na system tray",
        "Auto-update"
      ]
    },
    "v0.4.0": {
      "name": "Pokemon Theme",
      "features": [
        "Visual pixel art estilo Game Boy",
        "Tasks como batalhas Pokémon animadas",
        "HP bar = progresso da task",
        "Ataques = ações do Claude",
        "Sound effects 8-bit",
        "Cada PRD = um ginásio",
        "Badge ao completar PRD",
        "Pokédex de features implementadas"
      ]
    },
    "v0.5.0": {
      "name": "Integrations",
      "features": [
        "Pull tasks de GitHub Issues",
        "Pull tasks de Linear",
        "Sync status de volta para issue tracker",
        "Webhook para notificações externas"
      ]
    }
  },
  "config_defaults": {
    "maxIterationsPerTask": 10,
    "mode": "hitl",
    "feedbackLoops": ["test", "lint", "typecheck"],
    "timeoutMinutes": 30,
    "pollingIntervalMs": 2000,
    "autoCommit": true
  },
  "completion_sigil": "<promise>COMPLETE</promise>",
  "notes": [
    "Este PRD foi criado para ser executado pelo próprio PokéRalph (meta!)",
    "v0.1.0 foca em funcionalidade: core + server + web",
    "Tema Pokémon é v0.4.0 para não misturar complexidade",
    "Tasks de alta prioridade (core) devem ser HITL",
    "Tasks de baixa prioridade (docs, polish) podem ser YOLO",
    "Bun é o runtime único: workspaces, test, e execução",
    "Hono foi escolhido por ser leve e portátil (funciona em Bun, Deno, edge)",
    "Arquitetura em camadas permite adicionar CLI, desktop, mobile depois"
  ]
}
